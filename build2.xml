<project name="Selenium tests" basedir="." default="run-selenium-tests">
  
  <property name="lib.ant.dir" location="lib" />
  
	
  <path id="lib.testng">
    <fileset dir="${lib.ant.dir}" includes="*.jar"/>
  </path>
  <taskdef resource="testngtasks" classpathref="lib.testng" />
  
  <!-- define source location -->
  <property name="src.selenium-tests.dir" location="src" />
  
  <!-- Compile tests -->
  <target name="compile-selenium-tests">
    <javac srcdir="${src.selenium-tests.dir}" destdir="classes" fork="yes" 
	  executable="C:\Program Files\Java\jdk1.7.0_51\bin\javac.exe" >
      <classpath>  
        <fileset dir="${lib.ant.dir}" includes="selenium-server-standalone-2.35.0.jar"/>
        <fileset dir="${lib.ant.dir}" includes="testng.jar"/>        
      </classpath>
    </javac>
  </target>
  
  <target name="start-selenium-server">
    <java jar="${lib.ant.dir}/selenium-server-standalone-2.35.0.jar" fork="true" 
	  spawn="true" jvm="java.exe">
      <!-- Enable logging for the Selenium server -->
      <arg line="-log selenium.log -browserSideLog"/>
    </java>
  </target>
  
  <target name="stop-selenium-server">
      <get taskname="selenium-shutdown" 
	    src="http://localhost:4444/selenium-server/driver/?cmd=shutDownSeleniumServer"
        dest="result.txt" ignoreerrors="true" />
      
  </target>
  
  <!-- Run tests. -->
  <target name="run-selenium-tests" depends="compile-selenium-tests">
  	  <echo taskname="run-selenium-tests" message="DGF Errors during shutdown are expected" />
      <property name="build.classes.dir" location="classes" />
    
  	  <antcall target="start-selenium-server" />
      
      <testng outputdir="test-output" haltonfailure="false" 
	    haltonskipped="false" failureProperty="testsFailed">
        <!-- Compiled classes are in the build/classes directory -->
        <classpath>
           <pathelement location="${build.classes.dir}" />
          <fileset dir="${lib.ant.dir}" includes="selenium-server-standalone-2.35.0.jar"/>
          <fileset dir="${lib.ant.dir}" includes="testng.jar"/>          
        </classpath>
        <!-- List of tests to be run is in the testng.xml file in the src/system_tests/selenium directory -->
        <xmlfileset dir="." includes="testng.xml"/>
      </testng>
      
      <!-- Stop the Selenium RC server -->
      <antcall target="stop-selenium-server" />     
     
  </target>
</project>